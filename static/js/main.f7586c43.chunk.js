(this.webpackJsonpspeechstate=this.webpackJsonpspeechstate||[]).push([[0],{173:function(t,e,n){},221:function(t,e){},360:function(t,e){},363:function(t,e){},367:function(t,e){},368:function(t,e){},369:function(t,e){},370:function(t,e){},371:function(t,e){},459:function(t,e,n){"use strict";n.r(e);var r=n(169),o=n(9),a=(n(173),n(15),n(162)),i=n(26),c=n(96),u=n(3),s=n(462),l=n(463),f=n(97),d=n(51),m=n(6);function h(t){return Object(u.q)((function(e){return{type:"SPEAK",value:t(e)}}))}var g={meeting:{description:"create a meeting",patterns:[/Create a meeting./,/I would like to schedule a meeting./]},whois:{description:"request information about a person",patterns:[/Who is (.*)\?/,/Tell me something about (.*)\?/]},stop:{description:"stop me",patterns:[/Stop./,/Shut up./]},homeAssistant:{description:"ask me for home assistance",patterns:[/Can you help me with home assistance/,/Assist me in my home/]},options:{description:"",patterns:[/What can I do?/,/How can you help me?/]}},p={"Lecture.":"Dialogue systems lecture","Lunch.":"Lunch at the canteen","Training.":"Workout at the gym","Cinema.":"Watching a movie at the cinema","Shopping.":"Shopping in the city","Swedish course.":"Learning swedish","President.":"Talking to the president",Garden:"Walk in the garden",Sleeping:"Taking a nap"},b=/(At )?(((1[0-2]|[1-9]):[0-5][0-9]|(1[0-2]|[1-9]))( [AP]M)?( o'clock)?\.?)/,y=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday","Today","Tomorrow"],E={Yes:["Yes.","Of course.","Sure.","Yeah.","Yes please.","Yep.","OK.","Yes, thank you."],No:["No.","Nope.","No no.","Don't.","Don't do it.","No way.","Not at all."]},O={CR:["Sorry, could you please repeat that?","I didn't catch that?","What did you say?","Come again?","Sorry?","Huh?"]},v=[/Help./];function S(t){var e={hist:{type:"history"}};for(var n in t){var r;e=Object(o.a)(Object(o.a)({},e),{},(r={},Object(d.a)(r,"prompt"+n,{entry:h(t[n]),on:{ENDSPEECH:{target:"ask"+n}}}),Object(d.a)(r,"ask"+n,{entry:Object(u.q)("LISTEN"),on:{HIST:{target:parseInt(n)+1<t.length?"prompt"+(parseInt(n)+1):"#root.dm.init"}}}),r))}return e}function j(t){return{initial:"prompt0",states:Object(o.a)({},S(t))}}function k(t,e){switch(e){case"title":return t in p;case"day":var n,r=Object(f.a)(y);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(t.includes(o))return!0}}catch(a){r.e(a)}finally{r.f()}return!1;case"time":return b.test(t);default:return!1}}function T(t){var e;switch(t){case"title":e={title:function(t){return p[t.recResult[0].utterance]}};break;case"day":e={day:function(t){return y.find((function(e){return t.recResult[0].utterance.includes(e)}))}};break;case"time":e={time:function(t){var e=b.exec(t.recResult[0].utterance);return e[3]+(void 0!==e[6]?e[6]:"")}};break;default:e={}}return{type:m.a.Assign,assignment:e}}function C(t){switch(t){case"title":return function(t){return"For ".concat(t.title,"?")};case"day":return function(t){return"On ".concat(t.day,"?")};case"time":return function(t){return"At ".concat(t.time,"?")};default:return function(){return""}}}function w(t,e,n){return{initial:"prompt",states:{prompt:Object(o.a)({},j(t)),verify:Object(o.a)({},R([C(e)],"#"+n,"prompt"))},on:{RECOGNISED:[{target:n,cond:function(t){return k(t.recResult[0].utterance,e)&&t.recResult[0].confidence>.8},actions:Object(o.a)({},T(e))},{target:".verify",cond:function(t){return k(t.recResult[0].utterance,e)&&t.recResult[0].confidence<.8},actions:Object(o.a)({},T(e))}],TIMEOUT:{target:".prompt.hist",actions:Object(u.q)("HIST")}}}}function R(t,e,n){return Object(o.a)(Object(o.a)({},j(t)),{},{on:{RECOGNISED:[{target:e,cond:function(t){return E.Yes.includes(t.recResult[0].utterance)}},{target:n,cond:function(t){return E.No.includes(t.recResult[0].utterance)}}],TIMEOUT:{target:".hist",actions:Object(u.q)("HIST")}}})}var I={initial:"idle",on:{RECOGNISED:[{target:".help",cond:function(t){return v.some((function(e){return e.test(t.recResult[0].utterance)}))}},{target:".nomatch"}]},states:{idle:{on:{CLICK:"init"}},init:{on:{TTS_READY:"dialogue",CLICK:"dialogue"}},help:{entry:h((function(){return"I can help you to create meetings in your calendar"})),on:{ENDSPEECH:"dialogue.hist"}},nomatch:{entry:h((function(){return O.CR[Math.random()*O.CR.length|0]})),on:{ENDSPEECH:"dialogue.hist"}},dialogue:{initial:"getUsername",states:{hist:{type:"history",history:"deep"},getUsername:Object(o.a)(Object(o.a)({},j([function(){return"Hi, who are you?"},function(){return"What is your name?"},function(){return"Hello?"}])),{},{on:{RECOGNISED:[{target:"welcome",cond:function(t){return"I don't want to be known."===t.recResult[0].utterance}},{target:"welcome",actions:Object(u.b)({username:function(t){return t.recResult[0].utterance}})}],TIMEOUT:{target:".hist",actions:Object(u.q)("HIST")}}}),welcome:Object(o.a)(Object(o.a)({},j([function(t){return"How can I help you, ".concat(void 0!==t.username?t.username:"Anonymous","!")},function(){return"What can I do for you?"},function(t){return"".concat(void 0!==t.username?t.username:"Hello","?")}])),{},{on:{RECOGNISED:[{target:"createMeeting",cond:function(t){return g.meeting.patterns.some((function(e){return e.test(t.recResult[0].utterance)}))}},{target:"askForCelebrity",cond:function(t){return g.whois.patterns.some((function(e){return e.test(t.recResult[0].utterance)}))},actions:Object(u.b)({celebrityName:function(t){var e,n=Object(f.a)(g.whois.patterns);try{for(n.s();!(e=n.n()).done;){var r=e.value.exec(t.recResult[0].utterance);if(null!==r&&void 0!==r[1])return r[1]}}catch(o){n.e(o)}finally{n.f()}return""}})},{target:"homeAssistant",cond:function(t){return g.homeAssistant.patterns.some((function(e){return e.test(t.recResult[0].utterance)}))}},{target:"menuHelp",cond:function(t){return g.options.patterns.some((function(e){return e.test(t.recResult[0].utterance)}))}},{target:"#root.dm.init",cond:function(t){return g.stop.patterns.some((function(e){return e.test(t.recResult[0].utterance)}))}}],TIMEOUT:{target:".hist",actions:Object(u.q)("HIST")}}}),menuHelp:{entry:h((function(){var t="You can ";return Object.values(g).forEach((function(e){return""!==e.description?t+=e.description+" or ":""})),t.substr(0,t.length-4)+"."})),on:{ENDSPEECH:"welcome.hist"}},homeAssistant:{initial:"ask",states:{ask:Object(o.a)(Object(o.a)({},j([function(){return"How can I assist you?"},function(){return"How may I help you?"},function(t){return"".concat(t.username,"?")}])),{},{on:{RECOGNISED:"invokeRasa",TIMEOUT:{target:".hist",actions:Object(u.q)("HIST")}}}),invokeRasa:{invoke:{src:function(t){return N(t.recResult[0].utterance)},onDone:[{cond:function(t,e){return"vacuum"===e.data.intent.name},target:"vacuum"},{cond:function(t,e){return"move_to_trash"===e.data.intent.name},target:"moveToTrash"},{cond:function(t,e){return"give"===e.data.intent.name},target:"give"},{cond:function(t,e){return"turn_on_light"===e.data.intent.name},target:"turnOnLight"},{cond:function(t,e){return"turn_off_light"===e.data.intent.name},target:"turnOffLight"},{cond:function(t,e){return"cook"===e.data.intent.name},target:"cook"},{cond:function(t,e){return"ask_oven_warm"===e.data.intent.name},target:"askOvenWarm"},{cond:function(t,e){return"inform_oven_warm"===e.data.intent.name},target:"informOvenWarm"},{cond:function(t,e){return"stop"===e.data.intent.name},target:"stop"}],onError:"ask.hist"}},vacuum:{entry:h((function(){return"I will clean the floor."})),on:{ENDSPEECH:"ask"}},moveToTrash:{entry:h((function(){return"I will throw it into the trash."})),on:{ENDSPEECH:"ask"}},give:{entry:h((function(){return"I will give it to them."})),on:{ENDSPEECH:"ask"}},turnOnLight:{entry:h((function(){return"I'll turn on the light."})),on:{ENDSPEECH:"ask"}},turnOffLight:{entry:h((function(){return"I will turn off the light."})),on:{ENDSPEECH:"ask"}},cook:{entry:h((function(){return"I will prepare the meal."})),on:{ENDSPEECH:"ask"}},askOvenWarm:{entry:h((function(){var t=["The oven is warm.","The oven is cold."];return t[Math.random()*t.length|0]})),on:{ENDSPEECH:"ask"}},informOvenWarm:{entry:h((function(){return"Ok, thanks."})),on:{ENDSPEECH:"ask"}},stop:{entry:h((function(){return"Alright."})),on:{ENDSPEECH:"#root.dm.dialogue.welcome"}}}},askForCelebrity:{invoke:{src:function(t){return D(t.celebrityName)},onDone:{target:"infoCelebrity",actions:Object(u.b)({celebrityInfo:function(t,e){return e.data.Abstract.split(/\. [A-Z]/)[0]}})},onError:{target:"meetingCelebrity",actions:h((function(t){return"Sorry, I didn't get any info about ".concat(t.celebrityName)}))}}},infoCelebrity:{entry:h((function(t){return""!==t.celebrityInfo?t.celebrityInfo:"I couldn't find any info about ".concat(t.celebrityName,"!")})),on:{ENDSPEECH:{target:"meetingCelebrity",actions:Object(u.b)({title:function(t){return"Meeting with ".concat(t.celebrityName)}})}}},meetingCelebrity:Object(o.a)({},R([function(){return"Do you want to meet them?"},function(){return"Shall I create a meeting?"},function(t){return"".concat(t.username,"?")}],"getDay","welcome")),createMeeting:{entry:h((function(){return"Let's create a meeting."})),on:{ENDSPEECH:"getTitle"}},getTitle:Object(o.a)(Object(o.a)({},w([function(){return"What is it about?"},function(){return"How should I call the meeting?"},function(){return"What is the purpose?"}],"title","getDay")),{},{id:"getTitle"}),getDay:Object(o.a)(Object(o.a)({},w([function(){return"On which day is it?"},function(){return"Which day?"},function(t){return"".concat(t.username,"?")}],"day","wholeDay")),{},{id:"getDay"}),wholeDay:Object(o.a)(Object(o.a)({},R([function(){return"Will it take the whole day?"},function(){return"For the whole day?"},function(){return"Is it the whole day?"}],"confirmation","getTime")),{},{id:"wholeDay"}),getTime:Object(o.a)(Object(o.a)({},w([function(){return"What time is your meeting?"},function(){return"At which time?"},function(){return"When should is start?"}],"time","confirmation")),{},{id:"getTime"}),confirmation:Object(o.a)(Object(o.a)({},R([function(t){return"Do you want me to create a meeting titled ".concat(t.title," on ").concat(t.day," ")+"".concat(void 0!==t.time?"at ".concat(t.time):"for the whole day","?")}],"info","welcome")),{},{id:"confirmation"}),info:{entry:h((function(){return"Your meeting has been created!"})),on:{ENDSPEECH:"welcome"},id:"info"}}}}},N=function(t){return fetch(new Request("https://speechstate-lt2216-kuenkele.herokuapp.com/model/parse",{method:"POST",body:'{"text": "'.concat(t,'"}')})).then((function(t){return t.json()}))},D=function(t){return fetch(new Request("https://cors.eu.org/https://api.duckduckgo.com/?q=".concat(t,"&format=json&skip_disambig=1"))).then((function(t){return t.json()}))},x=n(163),H=n.n(x),A=n(166),P=n.n(A),L=n(13),U=i.a.send,_=i.a.cancel,W="northeurope";Object(l.a)({url:"https://statecharts.io/inspect",iframe:!1});var M=Object(c.a)({id:"root",type:"parallel",states:{dm:Object(o.a)({},I),asrtts:{initial:"init",states:{init:{on:{CLICK:{target:"getToken",actions:[Object(u.b)({audioCtx:function(t){return new(window.AudioContext||window.webkitAudioContext)}}),function(t){return navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){t.audioCtx.createMediaStreamSource(e)}))}]}}},getToken:{invoke:{id:"getAuthorizationToken",src:function(t,e){return z()},onDone:{actions:[Object(u.b)((function(t,e){return{azureAuthorizationToken:e.data}})),"ponyfillASR"],target:"ponyfillTTS"},onError:{target:"fail"}}},ponyfillTTS:{invoke:{id:"ponyTTS",src:function(t,e){return function(e,n){var r=P()({audioContext:t.audioCtx,credentials:{region:W,authorizationToken:t.azureAuthorizationToken}}),o=r.speechSynthesis,a=r.SpeechSynthesisUtterance;t.tts=o,t.ttsUtterance=a,t.tts.addEventListener("voiceschanged",(function(){t.tts.cancel();var n=t.tts.getVoices(),r=RegExp("en-US","u");r=RegExp("en-US","u");var o=n.find((function(t){return r.test(t.name)}));o?(t.voice=o,e("TTS_READY")):(console.error("TTS_ERROR: Could not get voice for regexp ".concat(r)),e("TTS_ERROR"))}))}}},on:{TTS_READY:"idle",TTS_ERROR:"fail"}},idle:{on:{LISTEN:"recognising",SPEAK:{target:"speaking",actions:Object(u.b)((function(t,e){return{ttsAgenda:e.value}}))}}},recognising:{initial:"noinput",exit:"recStop",on:{ASRRESULT:{actions:["recLogResult",Object(u.b)((function(t,e){return{recResult:e.value}}))],target:".match"},RECOGNISED:"idle",SELECT:"idle",CLICK:".pause",RECSTOP:"idle"},states:{noinput:{entry:["recStart",U({type:"TIMEOUT"},{delay:function(t){return 1e3*(t.tdmPassivity||3)},id:"timeout"})],on:{TIMEOUT:"#root.asrtts.idle",STARTSPEECH:"inprogress"},exit:_("timeout")},inprogress:{},match:{entry:U("RECOGNISED")},pause:{entry:"recStop",on:{CLICK:"noinput"}}}},speaking:{entry:"ttsStart",on:{ENDSPEECH:"idle",SELECT:"idle",CLICK:{target:"idle",actions:U("ENDSPEECH")}},exit:"ttsStop"},fail:{}}}}},{actions:{recLogResult:function(t){console.log("U>",t.recResult[0].utterance,t.recResult[0].confidence)},logIntent:function(t){console.log("<< NLU intent: "+t.nluData.intent.name)}}}),q=function(t){var e=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"name"===t.attribute}))||{}).value,n=((t.state.context.tdmVisualOutputInfo||[{}]).find((function(t){return"image"===t.attribute}))||{}).value,r="circle";switch(!0){case t.state.matches({asrtts:"fail"})||t.state.matches({dm:"fail"}):break;case t.state.matches({asrtts:{recognising:"pause"}}):e="Click to continue";break;case t.state.matches({asrtts:"recognising"}):r="circle-recognising",e=e||"Listening...";break;case t.state.matches({asrtts:"speaking"}):r="circle-speaking",e=e||"Speaking...";break;case t.state.matches({dm:"idle"}):case t.state.matches({dm:"init"}):e="Click to start!",r="circle-click";break;default:e=e||"\xa0"}return Object(L.jsxs)("div",{className:"control",children:[Object(L.jsx)("figure",{className:"prompt",children:n&&Object(L.jsx)("img",{src:n,alt:e})}),Object(L.jsxs)("div",{className:"status",children:[Object(L.jsx)("button",Object(o.a)({type:"button",className:r,style:{}},t)),Object(L.jsx)("div",{className:"status-text",children:e})]})]})},Y=function(t){var e=t.alternative.find((function(t){return"name"===t.attribute})).value,n=(t.alternative.find((function(t){return"image"===t.attribute}))||{}).value;return Object(L.jsxs)("figure",Object(o.a)(Object(o.a)({className:"flex"},t),{},{children:[n&&Object(L.jsx)("img",{src:n,alt:e}),Object(L.jsx)("figcaption",{children:e})]}))};function K(){var t=Object(s.b)(M,{devTools:!0,actions:{changeColour:Object(s.a)((function(t){document.body.style.background=t.recResult[0].utterance})),recStart:Object(s.a)((function(t){t.asr.start()})),recStop:Object(s.a)((function(t){t.asr.abort()})),ttsStart:Object(s.a)((function(t){var e='<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:mstts="http://www.w3.org/2001/mstts" xml:lang="en-US"><voice name="'.concat(t.voice.name,'">');e+='<lexicon uri="'.concat("https://dominikkuenkele.github.io/speechstate-lt2216/lexicon.xml",'"/>'),e+="".concat(t.ttsAgenda,"</voice></speak>"),console.debug(e);var n=new t.ttsUtterance(e);console.log("S>",t.ttsAgenda),n.voice=t.voice,n.onend=function(){return o("ENDSPEECH")},t.tts.speak(n)})),ttsStop:Object(s.a)((function(t){t.tts.cancel()})),ponyfillASR:Object(s.a)((function(t,e){var n=H()({audioContext:t.audioCtx,credentials:{region:W,authorizationToken:t.azureAuthorizationToken}}).SpeechRecognition;t.asr=new n,t.asr.lang="en-US",t.asr.continuous=!0,t.asr.interimResults=!0,t.asr.onresult=function(t){var e=t.results[0];e.isFinal?o({type:"ASRRESULT",value:[{utterance:e[0].transcript,confidence:e[0].confidence}]}):o({type:"STARTSPEECH"})}}))}}),e=Object(r.a)(t,2),n=e[0],o=e[1],a=(n.context.tdmExpectedAlternatives||[]).filter((function(t){return t.visual_information})).map((function(t,e){return Object(L.jsx)(Y,{state:n,alternative:t.visual_information,onClick:function(){return o({type:"SELECT",value:t.semantic_expression})}},e)}));return Object(L.jsxs)("div",{className:"App",children:[Object(L.jsx)(q,{state:n,alternative:{},onClick:function(){return o("CLICK")}}),Object(L.jsx)("div",{className:"select-wrapper",children:Object(L.jsx)("div",{className:"select",children:a})})]})}var z=function(){return fetch(new Request("https://northeurope.api.cognitive.microsoft.com/sts/v1.0/issuetoken",{method:"POST",headers:{"Ocp-Apim-Subscription-Key":"04fcf73736124086970f87a2dc9ec934"}})).then((function(t){return t.text()}))},G=document.getElementById("root");a.render(Object(L.jsx)(K,{}),G)}},[[459,1,2]]]);
//# sourceMappingURL=main.f7586c43.chunk.js.map